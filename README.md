# Модуль распределения товаров по разделам

## Постановка задачи
Реализовать функционал по распределению более чем 10 000 товаров (сущность Products модуля Sale в Bitrix) по разделам (Sections) в зависимости от различных параметров товара.

- Разделы могут быть основные, т.е. товар может быть только в этом разделе и не в каком другом с типом `One` (реализовано за счёт приоритетов).
- Разделы типа `Many` позволяют товару быть прикреплённым к любому количеству таких разделов.

Модуль выполняется в момент получения данных по товару из внешнего источника до сохранения товара в сущности Bitrix.

Результат работы модуля: перечень `ID` разделов, в которые товар должен сохраняться.

## Настройка логики разделов
- Настройка логики разделов хранится в HL-блоке **Configuration**.
- Данные заполняются контент-менеджерами при заведении нового товара.

## Процесс обработки
1. Код написан на основании шаблона проектирования ****.
2. В зависимости от типа конфигурации запускается соответствующий класс из папки /lib/Conditions, который сравнивает свойства товара и условия каждой из конфигураций и уже устанавливает соответствие.
3. На основании всех найденных соответствий происходит их обработка (удаление лишних значений разделов с типом One) и передача коду выше уровнем.

## Принцип работы и архитектура
1. Модуль после установки добавляет в ServiceLocator классы SectionsFacade и SectionsService. Непосредственно SectionsFacade::getByProductParameters принимает извне параметры в скальярных типах и производит сравнение и возвращает результат.
2. Все ключевые классы предполагающие модификацию выполняют контракты соответствующих интерфейсов, на которые и завязаны классы уровнем выше.
3. Код построен в соответсвии с принципами DI и разделен по слоям на Service/Model/Repository/DataMapper
4. Код соотвтествует PSR-12 за исключением ключей массивов bitrix которые в SNAKE_CASE.

## Почему реализовано в виде модуля
Используется отдельный модуль, так как планировалась работа на разных bitrix (на текущий момент 4) приложениях не связанных друг с другом с разной логикой хранения продуктов, но получающих данные в одном и том же виде из одного и тогоже иточника.

